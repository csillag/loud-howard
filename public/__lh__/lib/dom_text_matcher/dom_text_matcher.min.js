(function(){window.DomTextMatcher=function(){function t(t){this.mapper=t}return t.prototype.setRootNode=function(t){return this.mapper.setRootNode(t)},t.prototype.setRootId=function(t){return this.mapper.setRootId(t)},t.prototype.setRootIframe=function(t){return this.mapper.setRootIframe(t)},t.prototype.setRealRoot=function(){return this.mapper.setRealRoot()},t.prototype.documentChanged=function(){return this.mapper.documentChanged()},t.prototype.scan=function(){var t,e,r;return e=this.timestamp(),t=this.mapper.scan(),r=this.timestamp(),{time:r-e,data:t}},t.prototype.getDefaultPath=function(){return this.mapper.getDefaultPath()},t.prototype.searchExact=function(t,e,r,n){return null==e&&(e=!0),null==r&&(r=!1),null==n&&(n=null),this.pm||(this.pm=new window.DTM_ExactMatcher),this.pm.setDistinct(e),this.pm.setCaseSensitive(r),this.search(this.pm,t,null,n)},t.prototype.searchRegex=function(t,e,r){return null==e&&(e=!1),null==r&&(r=null),this.rm||(this.rm=new window.DTM_RegexMatcher),this.rm.setCaseSensitive(e),this.search(this.rm,t,null,r)},t.prototype.searchFuzzy=function(t,e,r,n,a,s){if(null==r&&(r=!1),null==n&&(n=1e3),null==a&&(a=.5),null==s&&(s=null),null==this.dmp){if(null==window.DTM_DMPMatcher)throw Error("DTM_DMPMatcher is not available. Have you loaded the text match engines?");this.dmp=new window.DTM_DMPMatcher}return this.dmp.setMatchDistance(n),this.dmp.setMatchThreshold(a),this.dmp.setCaseSensitive(r),this.search(this.dmp,t,e,s)},t.prototype.search=function(t,e,r,n){var a,s,o,i,p,h,u,l,c,m,f,d=this;if(null==n&&(n=null),null==e)throw Error("Can't search for null pattern!");if(e=e.trim(),null==e)throw Error("Can't search an for empty pattern!");if(i=this.timestamp(),null!=n&&this.scan(),p=this.timestamp(),null==this.mapper.corpus)throw Error("Not prepared to search! (call PrepareSearch, or pass me a path)");for(l=t.search(this.mapper.corpus,e,r),h=this.timestamp(),s=[],c=function(t){var r,n,a;return r=d.analyzeMatch(e,t),n=d.mapper.getMappingsForCharRange(t.start,t.end),a=$.extend({},t,r,n),s.push(a),null},m=0,f=l.length;f>m;m++)a=l[m],c(a);return u=this.timestamp(),o={matches:s,time:{phase0_domMapping:p-i,phase1_textMatching:h-p,phase2_matchMapping:u-h,total:u-i}}},t.prototype.timestamp=function(){return(new Date).getTime()},t.prototype.analyzeMatch=function(t,e){var r,n;return r=this.mapper.corpus.substr(e.start,e.end-e.start),n={found:r,exact:r===t}},t}()}).call(this);